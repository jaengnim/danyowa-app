<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#4f46e5" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="다녀와">
    
    <title>다녀와 - 우리 아이 일정 매니저</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2693/2693507.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              gray: {
                750: '#2d3748',
                850: '#1a202c',
                900: '#111827',
                950: '#030712',
              }
            }
          }
        }
      }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #f3f4f6;
        transition: background-color 0.3s ease;
        overscroll-behavior-y: none;
      }
      .dark body {
        background-color: #111827;
      }
      .no-scrollbar::-webkit-scrollbar {
          display: none;
      }
      .no-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
      .safe-area-bottom {
        padding-bottom: env(safe-area-inset-bottom);
      }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js', { scope: '/' })
            .then(reg => {
              console.log('SW registered', reg);
              // #region agent log
              fetch('http://127.0.0.1:7242/ingest/d3246301-7d65-4efc-ae7c-8b9ee7f0f794',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:register',message:'Service Worker registered',data:{scope:reg.scope,active:reg.active?.state,installing:reg.installing?.state,waiting:reg.waiting?.state},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
              // #endregion
              
              // Check for updates
              reg.addEventListener('updatefound', () => {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/d3246301-7d65-4efc-ae7c-8b9ee7f0f794',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:updatefound',message:'Service Worker update found',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                // #endregion
                const newWorker = reg.installing;
                if (newWorker) {
                  newWorker.addEventListener('statechange', () => {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/d3246301-7d65-4efc-ae7c-8b9ee7f0f794',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:statechange',message:'Service Worker state changed',data:{state:newWorker.state},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                    // #endregion
                    if (newWorker.state === 'activated') {
                      // #region agent log
                      fetch('http://127.0.0.1:7242/ingest/d3246301-7d65-4efc-ae7c-8b9ee7f0f794',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:activated',message:'Service Worker activated',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                      // #endregion
                    }
                  });
                }
              });
              
              // Check if already active
              if (reg.active) {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/d3246301-7d65-4efc-ae7c-8b9ee7f0f794',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:active',message:'Service Worker already active',data:{state:reg.active.state},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                // #endregion
              }
            })
            .catch(err => {
              console.log('SW failed', err);
              // #region agent log
              fetch('http://127.0.0.1:7242/ingest/d3246301-7d65-4efc-ae7c-8b9ee7f0f794',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:register',message:'Service Worker registration failed',data:{error:err.message,stack:err.stack},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
              // #endregion
            });
        });
      } else {
        // #region agent log
        fetch('http://127.0.0.1:7242/ingest/d3246301-7d65-4efc-ae7c-8b9ee7f0f794',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:register',message:'Service Worker not supported',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
        // #endregion
      }
    </script>
  </body>
</html>